PAIP.彩票系统的对外接口流程实录

这几天，做了下彩票系统的统一接口，在此纪录。。完整的表明如何做真正的模块化....

目前，常常所谓的模块化，但是模块化往往都不是跨语言的，比如。NET开发的模块就不能在JAVA系统中使用。。而这里的模块化是真正的跨平台跨语言的..

手中有一套彩票系统，是ASP+SQL SERER的，准备对接DISCUZ X2.5中的积分金钱系统 PHP+MYSQL。。也就是说用户系统和账务系统就准备使用DISCUZ X的了。。

首先，在彩票系统，进行文档化...对要抽出的模块详细文档化.
..建立接口文件，userNacc.asp  ,以后对用户和账户的操作就通过它了..设立一个统一的KEY，以在两个系统中进行签名,
新加方法 una_getCurUserName() //获取登录用户名 ,此用户名是在DISCUZ上打开时，通过URL GET方式注入的。。
取账户余额 Function una_AccBalance() ,  通过调用/unaapi.php?method=getbalance&unam unaapi.php是在DISCUZ中新建的接口文件..
账户扣钱  una_AccMinus(pay) ，调用/unaapi.php进行扣钱操作
 账户返奖una_AccBonus(pay)，调用/unaapi.php进行返奖操作
进行功能点抽出，主要抽出投注模块，开奖,对奖，反奖等。。。在这些功能点中，用到的取用户名，以及账户操作要改为 userNacc.asp  中的..
至此，ASP方面的接口基本齐备了...此外，对接口参数需进行MD5签名，防篡改..
----------------------------------------------------------------------------------
现在开始DISCUZ中的接口工程
在导航上增加一个栏目，连接至  /unaapi.php?Method=toasp 
在unaapi.php中，建立方法 TOASP(),，准备转入彩票系统,需要把用户名通过URL GET方法注入彩票系统中..
在unaapi.php中,建立账户余额，扣钱，返奖等方法.
这样，在 userNacc.asp 和 UNAAPI。PHP中就分别建立了相应的方法，来进行互操作.... 

==================================
14安全性：因为涉及到账户的操作,所以一定要做好安全性.
..在接口参数中增加时间数因子,与其它参数一起MD5签名，使其连接只能使用一次...如果被第三方截获，不可使用了。
过期提交 。。。仅仅解决一次性使用问题还不够，需要进行有效期设定，这样可以避免风险....每个表单可放一个隐藏域，放着收到表单的时间,并进行签名..表单如果在规定的时间内没有提交 ，则需要重新刷新此时间域TOKEN。。可以用AJAX方式来定期刷新此TOKEY，用户体验更好...一般彩票投注可设定为30分钟。。
账户提醒。。当收到连接频繁的提交却验证出错，需要及时提醒相关人员。。

